<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard - Mini Learning Portal</title>
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a href="/" class="navbar-brand">âš¡ LearnHub</a>
      <ul class="navbar-menu">
        <li><a href="/">Home</a></li>
        <li><a href="/courses.html">Courses</a></li>
      </ul>
      <div class="navbar-actions">
        <a href="#" onclick="utils.logout()" class="btn btn-secondary btn-small">Logout</a>
      </div>
    </div>
  </nav>

  <main class="container" style="margin-top: 2rem;">
    <div id="dashboard-content">
      <div class="spinner"></div>
    </div>
  </main>

  <script src="/js/main.js"></script>
  <script>
    async function loadDashboard() {
      try {
        const data = await utils.apiCall('/api/dashboard');
        const user = data.user;
        const enrollments = data.enrollments;

        document.getElementById('dashboard-content').innerHTML = `
          <h1 class="mb-2">Welcome back, ${user.username}!</h1>
          
          <div class="grid grid-3 mb-3">
            <div class="stat-card card">
              <div class="stat-value">${enrollments.length}</div>
              <div class="stat-label">Enrolled Courses</div>
            </div>
            <div class="stat-card card">
              <div class="stat-value">${Math.round(enrollments.reduce((sum, e) => sum + e.progress, 0) / (enrollments.length || 1))}%</div>
              <div class="stat-label">Avg Progress</div>
            </div>
            <div class="stat-card card">
              <div class="stat-value">${enrollments.filter(e => e.progress === 100).length}</div>
              <div class="stat-label">Completed</div>
            </div>
          </div>
          
          <h2 class="mb-2">Your Courses</h2>
          ${enrollments.length === 0 ? `
            <div class="card">
              <p class="text-muted">You haven't enrolled in any courses yet.</p>
              <a href="/courses" class="btn btn-primary mt-1">Browse Courses</a>
            </div>
          ` : `
            <div class="grid grid-3">
              ${enrollments.map(enrollment => `
                <div class="card course-card">
                  <div class="course-meta">
                    <span class="badge badge-primary">${enrollment.category}</span>
                    <span class="badge badge-success">${enrollment.level}</span>
                  </div>
                  <h3 class="card-title">${enrollment.title}</h3>
                  <p class="card-text">${enrollment.description}</p>
                  <div class="mb-1">
                    <div style="background: var(--color-bg-tertiary); height: 8px; border-radius: 4px; overflow: hidden;">
                      <div style="background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); height: 100%; width: ${enrollment.progress}%;"></div>
                    </div>
                    <p class="text-muted" style="font-size: 0.875rem; margin-top: 0.5rem;">${enrollment.progress}% complete</p>
                  </div>
                  <a href="/courses/${enrollment.id}" class="btn btn-primary">Continue Learning</a>
                </div>
              `).join('')}
            </div>
          `}
        `;
      } catch (error) {
        if (error.message.includes('Authentication required')) {
          window.location.href = '/login';
        } else {
          document.getElementById('dashboard-content').innerHTML =
            '<div class="alert alert-error">Failed to load dashboard</div>';
        }
      }
    }

    loadDashboard();
  </script>
</body>

</html>